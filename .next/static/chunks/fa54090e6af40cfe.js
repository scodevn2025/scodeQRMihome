(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return r}});let r=e=>{}},9165,55595,71614,75254,26707,16715,e=>{"use strict";function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}e.s(["apiClient",()=>a],9165),e.i(47167),e.s([],71614);let s=new class{async login(e,t){try{let s=await this.getCaptcha();if(!s.success)return{success:!1,error:"Failed to get captcha"};let r=await this.performLogin(e,t,s.captcha);if(!r.success)return{success:!1,error:"Login failed"};let a=await this.getServiceToken(r.token);if(!a.success)return{success:!1,error:"Failed to get service token"};return{success:!0,token:r.token,service_token:a.service_token,security_token:a.security_token,user_id:r.user_id,user_name:r.user_name,user_avatar:r.user_avatar}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async QRlogin(){try{let e={qr_id:this.generateQRId(),timestamp:Date.now(),action:"login"};return"mijia://login?qr_id=".concat(e.qr_id,"&timestamp=").concat(e.timestamp),{success:!0,token:"qr_token_".concat(e.qr_id),service_token:"service_token_".concat(e.qr_id),security_token:"security_token_".concat(e.qr_id),user_id:"qr_user",user_name:"QR User",user_avatar:null}}catch(e){return{success:!1,error:e instanceof Error?e.message:"QR login failed"}}}async getCaptcha(){try{let e=await fetch("".concat(this.baseUrl,"/pass/serviceLoginAuth2"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({sid:"xiaomiio",hash:"HASH_VALUE",callback:"https://sts.api.io.mi.com/sts",qs:"%3Fsid%3Dxiaomiio%26_json%3Dtrue",user:"",_json:"true"})}),t=await e.json();return{success:!0,captcha:t}}catch(e){return{success:!1,error:"Failed to get captcha"}}}async performLogin(e,t,s){try{let r=await fetch("".concat(this.baseUrl,"/pass/serviceLoginAuth2"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({sid:"xiaomiio",hash:"HASH_VALUE",callback:"https://sts.api.io.mi.com/sts",qs:"%3Fsid%3Dxiaomiio%26_json%3Dtrue",user:e,hash:t,_json:"true",...s})}),a=await r.json();if(0===a.code)return{success:!0,token:a.token,user_id:a.user_id,user_name:a.user_name,user_avatar:a.user_avatar};return{success:!1,error:a.desc||"Login failed"}}catch(e){return{success:!1,error:"Login request failed"}}}async getServiceToken(e){try{let t=await fetch("".concat(this.serviceUrl,"/home/device_list"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({getVirtualModel:!1,getHuamiDevices:0})}),s=await t.json();if(0===s.code)return{success:!0,service_token:s.service_token,security_token:s.security_token};return{success:!1,error:"Failed to get service token"}}catch(e){return{success:!1,error:"Service token request failed"}}}generateQRId(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}constructor(){t(this,"baseUrl","https://account.xiaomi.com"),t(this,"serviceUrl","https://api.io.mi.com/app")}};e.s(["mijiaAPI",()=>r],55595);let r=new class{setSession(e){this.session=e}async request(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(null==(t=this.session)?void 0:t.service_token))return{success:!1,error:"Not authenticated"};try{let t=this.generateNonce(),r=this.generateSignedNonce(this.session.ssecurity||"",t),a=this.formatData("string"==typeof s.body?s.body:"{}"),o=this.generateSignature(e,r,t,a),i=new URLSearchParams;i.append("_nonce",t),i.append("data",a),i.append("signature",o);let c=await fetch("".concat(this.baseUrl).concat(e),{method:"POST",headers:{"User-Agent":"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Mobile Safari/537.36 Edg/126.0.0.0","x-xiaomi-protocal-flag-cli":"PROTOCAL-HTTP2",Cookie:"PassportDeviceId=".concat(this.session.passport_device_id,";userId=").concat(this.session.user_id,";serviceToken=").concat(this.session.service_token,";"),"Content-Type":"application/x-www-form-urlencoded",...s.headers},body:i}),n=await c.json();if(0===n.code)return{success:!0,data:n.result||n};return{success:!1,error:"获取数据失败, ".concat(n.message)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Network error"}}}generateNonce(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let s=0;s<16;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}generateSignedNonce(e,t){let s=e+t,r=0;for(let e=0;e<s.length;e++)r=(r<<5)-r+s.charCodeAt(e),r&=r;return btoa(r.toString())}generateSignature(e,t,s,r){let a="".concat(e,"&").concat(t,"&").concat(s,"&data=").concat(r),o=0;for(let e=0;e<a.length;e++)o=(o<<5)-o+a.charCodeAt(e),o&=o;return btoa(o.toString())}formatData(e){return e.replace(/'/g,'"').replace(/True/g,"true").replace(/False/g,"false")}async get_devices_list(){let e=await this.get_homes_list();if(!e.success||!e.data)return{success:!1,error:"Failed to get homes list"};let t=[],s=new Set;for(let a of e.data){let e="",o=!0;for(;o;){var r;let i=await this.request("/home/home_device_list",{method:"POST",body:JSON.stringify({home_owner:a.id,home_id:parseInt(a.id),limit:200,start_did:e,get_split_device:!0,support_smart_home:!0,get_cariot_device:!0,get_third_device:!0,get_share_device:!0,get_room_device:!0,get_all_device:!0})});if(i.success&&(null==(r=i.data)?void 0:r.device_info)){for(let e of i.data.device_info){let r=e.did||e.id;r&&!s.has(r)&&(s.add(r),t.push(e))}e=i.data.next_did||"",o=i.data.has_more&&""!==e}else o=!1}}return{success:!0,data:t}}async get_shared_devices(){var e;let t=await this.request("/home/home_device_list",{method:"POST",body:JSON.stringify({get_share_device:!0,get_split_device:!0,get_third_device:!0,limit:500})});return t.success&&(null==(e=t.data)?void 0:e.device_info)?{success:!0,data:t.data.device_info}:{success:!0,data:[]}}async get_all_devices(){let e=await this.get_devices_list();if(!e.success)return e;let t=await this.get_shared_devices();if(!t.success)return t;let s=[...e.data||[]],r=new Set(s.map(e=>e.id));for(let e of t.data||[]){let t=e.id;t&&!r.has(t)&&(r.add(t),s.push(e))}return{success:!0,data:s}}async get_homes_list(){var e;let t=await this.request("/v2/homeroom/gethome_merged",{method:"POST",body:JSON.stringify({fg:!0,fetch_share:!0,fetch_share_dev:!0,limit:300,app_ver:7})});return t.success&&(null==(e=t.data)?void 0:e.home_list)?{success:!0,data:t.data.home_list}:{success:!1,error:"Failed to get homes list"}}async get_scenes_list(e){var t;let s=await this.request("/appgateway/miot/appsceneservice/AppSceneService/GetSceneList",{method:"POST",body:JSON.stringify({home_id:e})});return s.success&&(null==(t=s.data)?void 0:t.scene_info_list)?{success:!0,data:s.data.scene_info_list}:{success:!0,data:[]}}async run_scene(e){let t=await this.request("/appgateway/miot/appsceneservice/AppSceneService/RunScene",{method:"POST",body:JSON.stringify({scene_id:e,trigger_key:"user.click"})});return{success:t.success,data:t.success}}async get_devices_prop(e){let t=await this.request("/miotspec/prop/get",{method:"POST",body:JSON.stringify({params:[{did:e.id,siid:2,piid:1}]})});return{success:t.success,data:t.data||[]}}async set_devices_prop(e){let t=Object.entries(e.properties).map(t=>{let[,s]=t;return{did:e.id,siid:2,piid:1,value:s}}),s=await this.request("/miotspec/prop/set",{method:"POST",body:JSON.stringify({params:t})});return{success:s.success,data:s.data||[]}}async run_action(e){let t=await this.request("/miotspec/action",{method:"POST",body:JSON.stringify({params:{did:e.device_id,siid:2,aiid:1,value:e.params}})});return{success:t.success,data:t.data||{}}}async get_device_by_name(e){let t=await this.get_devices_list();return t.success&&t.data?{success:!0,data:t.data.find(t=>t.name===e)||null}:{success:!1,error:"Failed to get devices"}}async get_device_by_id(e){let t=await this.get_devices_list();return t.success&&t.data?{success:!0,data:t.data.find(t=>t.id===e)||null}:{success:!1,error:"Failed to get devices"}}async update_device(e){let t=await this.get_device_by_id(e.device_id);if(!t.success||!t.data)return{success:!1,error:"Device not found"};let s=t.data;return s.properties={...s.properties,...e.properties},await this.set_devices_prop(s)}constructor(e){t(this,"session",null),t(this,"baseUrl","https://api.io.mi.com/app"),e&&(this.session=e)}},a=new class{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{console.log("🌐 API Client: Making request to:","".concat("","/api").concat(e)),console.log("📤 API Client: Request options:",{method:t.method||"GET",headers:t.headers});let s=await fetch("".concat("","/api").concat(e),{headers:{"Content-Type":"application/json",...t.headers},...t});console.log("📥 API Client: Response received:",{status:s.status,ok:s.ok,statusText:s.statusText});let r=await s.json();return console.log("📊 API Client: Response data:",{success:r.success,hasData:!!r.data,error:r.error}),r}catch(e){return console.error("❌ API Client: Request error:",e),console.error("🔍 Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),{success:!1,error:"Network error occurred"}}}async generateQR(){console.log("🌐 API Client: Generating QR code...");try{let e=await this.request("/auth/qr",{method:"POST"});return console.log("✅ API Client: QR generation result:",{success:e.success,hasData:!!e.data,error:e.error}),e}catch(e){return console.error("❌ API Client: QR generation error:",e),{success:!1,error:"Failed to generate QR code"}}}async checkQRStatus(e){console.log("🔍 API Client: Checking QR status for ID:",e);try{var t,s,r;let a=await this.request("/auth/qr?qr_id=".concat(e));return console.log("📥 API Client: QR status result:",{success:a.success,status:null==(t=a.data)?void 0:t.status,hasToken:!!(null==(s=a.data)?void 0:s.token),hasUser:!!(null==(r=a.data)?void 0:r.user),error:a.error}),a}catch(e){return console.error("❌ API Client: QR status check error:",e),{success:!1,error:"Failed to check QR status"}}}async getDevices(){try{let e=await r.get_all_devices();if(!e.success||!e.data)return{success:!0,data:[{id:"mock-device-1",name:"Mock Light",type:"light",model:"yeelink.light.lamp4",online:!0,properties:{on:!0,brightness:80,colorTemperature:4e3},room:"Living Room"},{id:"mock-device-2",name:"Mock Sensor",type:"sensor",model:"miaomiaoce.sensor_ht.t1",online:!0,properties:{temperature:25.5,humidity:60},room:"Bedroom"}]};{let t=e.data.map(e=>({id:e.did||e.id,name:e.name||"Unknown Device",type:this.mapDeviceType(e.model),model:e.model||"unknown",online:e.is_online||!1,properties:e.properties||{},room:e.room_name||"Unknown Room"}));return{success:!0,data:t}}}catch(e){return{success:!1,error:"Failed to get devices"}}}mapDeviceType(e){if(!e)return"unknown";let t=e.toLowerCase();return t.includes("light")||t.includes("lamp")?"light":t.includes("sensor")||t.includes("ht")?"sensor":t.includes("camera")?"camera":t.includes("speaker")?"speaker":t.includes("switch")?"switch":t.includes("plug")?"plug":"unknown"}async getHomes(){console.log("🔍 API Client: Getting homes from Mijia API...");try{let e=await r.get_homes_list();if(console.log("📥 Mijia API homes response:",e),e.success&&e.data)return{success:!0,data:e.data};return console.log("⚠️ Mijia API failed, using mock data"),{success:!0,data:[{id:"mock-home-1",name:"My Home",address:"123 Main St",roomlist:[{id:"room-1",name:"Living Room",dids:["mock-device-1"]},{id:"room-2",name:"Bedroom",dids:["mock-device-2"]}]}]}}catch(e){return console.error("❌ API Client: Get homes error:",e),{success:!1,error:"Failed to get homes"}}}async getScenes(e){console.log("🔍 API Client: Getting scenes for home:",e);try{let t=await r.get_scenes_list(e);if(console.log("📥 Mijia API scenes response:",t),t.success&&t.data)return{success:!0,data:t.data};{console.log("⚠️ Mijia API failed, using mock data");let t=[{id:"scene-1",name:"Good Morning",description:"Turn on lights and open curtains",enabled:!0,homeId:e},{id:"scene-2",name:"Good Night",description:"Turn off all lights",enabled:!0,homeId:e}];return{success:!0,data:t}}}catch(e){return console.error("❌ API Client: Get scenes error:",e),{success:!1,error:"Failed to get scenes"}}}async runScene(e){console.log("🔍 API Client: Running scene:",e);try{let t=await r.run_scene(e);if(console.log("📥 Mijia API run scene response:",t),t.success)return{success:!0,data:{message:"Scene ".concat(e," executed successfully")}};return{success:!1,error:t.error||"Failed to run scene"}}catch(e){return console.error("❌ API Client: Run scene error:",e),{success:!1,error:"Failed to run scene"}}}async getDeviceProperties(e){console.log("🔍 API Client: Getting device properties for:",e);try{let t=await r.get_devices_prop({did:e});if(console.log("📥 Mijia API device properties response:",t),t.success&&t.data)return{success:!0,data:t.data};return console.log("⚠️ Mijia API failed, using mock data"),{success:!0,data:{on:!0,brightness:80,colorTemperature:4e3,temperature:25.5,humidity:60}}}catch(e){return console.error("❌ API Client: Get device properties error:",e),{success:!1,error:"Failed to get device properties"}}}async updateDevice(e,t){console.log("🔍 API Client: Updating device:",e,t);try{let s=await r.update_device({device_id:e,properties:t});if(console.log("📥 Mijia API update device response:",s),s.success)return{success:!0,data:{message:"Device ".concat(e," updated successfully")}};return{success:!1,error:s.error||"Failed to update device"}}catch(e){return console.error("❌ API Client: Update device error:",e),{success:!1,error:"Failed to update device"}}}async executeDeviceAction(e,t){console.log("🔍 API Client: Executing device action:",e,t);try{let s=await r.run_action({device_id:e,action:t.action||"set_property",params:t.params||[]});if(console.log("📥 Mijia API execute action response:",s),s.success)return{success:!0,data:{message:"Action ".concat(t.action," executed successfully on device ").concat(e)}};return{success:!1,error:s.error||"Failed to execute device action"}}catch(e){return console.error("❌ API Client: Execute device action error:",e),{success:!1,error:"Failed to execute device action"}}}async loginWithCredentials(e,t){console.log("🔍 API Client: Login with credentials:",e);try{let a=await s.login(e,t);if(console.log("📥 Mijia Auth login response:",a),a.success)return r.setSession(a.data),{success:!0,data:a.data};return{success:!1,error:a.error||"Login failed"}}catch(e){return console.error("❌ API Client: Login with credentials error:",e),{success:!1,error:"Login failed"}}}async loginWithQR(){console.log("🔍 API Client: Login with QR");try{let e=await s.QRlogin();if(console.log("📥 Mijia Auth QR login response:",e),e.success)return r.setSession(e.data),{success:!0,data:e.data};return{success:!1,error:e.error||"QR Login failed"}}catch(e){return console.error("❌ API Client: Login with QR error:",e),{success:!1,error:"QR Login failed"}}}};e.s(["default",()=>l],75254);var o=e.i(71645);let i=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},c=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,o.forwardRef)((e,t)=>{let{color:s="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:d="",children:l,iconNode:u,...h}=e;return(0,o.createElement)("svg",{ref:t,...n,width:r,height:r,stroke:s,strokeWidth:i?24*Number(a)/Number(r):a,className:c("lucide",d),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...u.map(e=>{let[t,s]=e;return(0,o.createElement)(t,s)}),...Array.isArray(l)?l:[l]])}),l=(e,t)=>{let s=(0,o.forwardRef)((s,r)=>{let{className:a,...n}=s;return(0,o.createElement)(d,{ref:r,iconNode:t,className:c("lucide-".concat(i(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),a),...n})});return s.displayName=i(e),s};e.s(["Smartphone",()=>u],26707);let u=l("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);e.s(["RefreshCw",()=>h],16715);let h=l("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}]);