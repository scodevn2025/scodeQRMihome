module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},61724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},42299,74601,e=>{"use strict";e.s([],42299),new class{baseUrl="https://account.xiaomi.com";serviceUrl="https://api.io.mi.com/app";async login(e,t){try{let r=await this.getCaptcha();if(!r.success)return{success:!1,error:"Failed to get captcha"};let s=await this.performLogin(e,t,r.captcha);if(!s.success)return{success:!1,error:"Login failed"};let a=await this.getServiceToken(s.token);if(!a.success)return{success:!1,error:"Failed to get service token"};return{success:!0,token:s.token,service_token:a.service_token,security_token:a.security_token,user_id:s.user_id,user_name:s.user_name,user_avatar:s.user_avatar}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async QRlogin(){try{let e={qr_id:this.generateQRId(),timestamp:Date.now(),action:"login"};return e.qr_id,e.timestamp,{success:!0,token:`qr_token_${e.qr_id}`,service_token:`service_token_${e.qr_id}`,security_token:`security_token_${e.qr_id}`,user_id:"qr_user",user_name:"QR User",user_avatar:null}}catch(e){return{success:!1,error:e instanceof Error?e.message:"QR login failed"}}}async getCaptcha(){try{let e=await fetch(`${this.baseUrl}/pass/serviceLoginAuth2`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({sid:"xiaomiio",hash:"HASH_VALUE",callback:"https://sts.api.io.mi.com/sts",qs:"%3Fsid%3Dxiaomiio%26_json%3Dtrue",user:"",_json:"true"})}),t=await e.json();return{success:!0,captcha:t}}catch(e){return{success:!1,error:"Failed to get captcha"}}}async performLogin(e,t,r){try{let s=await fetch(`${this.baseUrl}/pass/serviceLoginAuth2`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({sid:"xiaomiio",hash:"HASH_VALUE",callback:"https://sts.api.io.mi.com/sts",qs:"%3Fsid%3Dxiaomiio%26_json%3Dtrue",user:e,hash:t,_json:"true",...r})}),a=await s.json();if(0===a.code)return{success:!0,token:a.token,user_id:a.user_id,user_name:a.user_name,user_avatar:a.user_avatar};return{success:!1,error:a.desc||"Login failed"}}catch(e){return{success:!1,error:"Login request failed"}}}async getServiceToken(e){try{let t=await fetch(`${this.serviceUrl}/home/device_list`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({getVirtualModel:!1,getHuamiDevices:0})}),r=await t.json();if(0===r.code)return{success:!0,service_token:r.service_token,security_token:r.security_token};return{success:!1,error:"Failed to get service token"}}catch(e){return{success:!1,error:"Service token request failed"}}}generateQRId(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}},e.s(["mijiaAPI",()=>t],74601);let t=new class{session=null;baseUrl="https://api.io.mi.com/app";constructor(e){e&&(this.session=e)}setSession(e){this.session=e}async request(e,t={}){if(!this.session?.service_token)return{success:!1,error:"Not authenticated"};try{let r=this.generateNonce(),s=this.generateSignedNonce(this.session.ssecurity||"",r),a=this.formatData("string"==typeof t.body?t.body:"{}"),i=this.generateSignature(e,s,r,a),n=new URLSearchParams;n.append("_nonce",r),n.append("data",a),n.append("signature",i);let o=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{"User-Agent":"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Mobile Safari/537.36 Edg/126.0.0.0","x-xiaomi-protocal-flag-cli":"PROTOCAL-HTTP2",Cookie:`PassportDeviceId=${this.session.passport_device_id};userId=${this.session.user_id};serviceToken=${this.session.service_token};`,"Content-Type":"application/x-www-form-urlencoded",...t.headers},body:n}),c=await o.json();if(0===c.code)return{success:!0,data:c.result||c};return{success:!1,error:`获取数据失败, ${c.message}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Network error"}}}generateNonce(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let r=0;r<16;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}generateSignedNonce(e,t){let r=e+t,s=0;for(let e=0;e<r.length;e++)s=(s<<5)-s+r.charCodeAt(e),s&=s;return btoa(s.toString())}generateSignature(e,t,r,s){let a=`${e}&${t}&${r}&data=${s}`,i=0;for(let e=0;e<a.length;e++)i=(i<<5)-i+a.charCodeAt(e),i&=i;return btoa(i.toString())}formatData(e){return e.replace(/'/g,'"').replace(/True/g,"true").replace(/False/g,"false")}async get_devices_list(){let e=await this.get_homes_list();if(!e.success||!e.data)return{success:!1,error:"Failed to get homes list"};let t=[],r=new Set;for(let s of e.data){let e="",a=!0;for(;a;){let i=await this.request("/home/home_device_list",{method:"POST",body:JSON.stringify({home_owner:s.id,home_id:parseInt(s.id),limit:200,start_did:e,get_split_device:!0,support_smart_home:!0,get_cariot_device:!0,get_third_device:!0,get_share_device:!0,get_room_device:!0,get_all_device:!0})});if(i.success&&i.data?.device_info){for(let e of i.data.device_info){let s=e.did||e.id;s&&!r.has(s)&&(r.add(s),t.push(e))}e=i.data.next_did||"",a=i.data.has_more&&""!==e}else a=!1}}return{success:!0,data:t}}async get_shared_devices(){let e=await this.request("/home/home_device_list",{method:"POST",body:JSON.stringify({get_share_device:!0,get_split_device:!0,get_third_device:!0,limit:500})});return e.success&&e.data?.device_info?{success:!0,data:e.data.device_info}:{success:!0,data:[]}}async get_all_devices(){let e=await this.get_devices_list();if(!e.success)return e;let t=await this.get_shared_devices();if(!t.success)return t;let r=[...e.data||[]],s=new Set(r.map(e=>e.id));for(let e of t.data||[]){let t=e.id;t&&!s.has(t)&&(s.add(t),r.push(e))}return{success:!0,data:r}}async get_homes_list(){let e=await this.request("/v2/homeroom/gethome_merged",{method:"POST",body:JSON.stringify({fg:!0,fetch_share:!0,fetch_share_dev:!0,limit:300,app_ver:7})});return e.success&&e.data?.home_list?{success:!0,data:e.data.home_list}:{success:!1,error:"Failed to get homes list"}}async get_scenes_list(e){let t=await this.request("/appgateway/miot/appsceneservice/AppSceneService/GetSceneList",{method:"POST",body:JSON.stringify({home_id:e})});return t.success&&t.data?.scene_info_list?{success:!0,data:t.data.scene_info_list}:{success:!0,data:[]}}async run_scene(e){let t=await this.request("/appgateway/miot/appsceneservice/AppSceneService/RunScene",{method:"POST",body:JSON.stringify({scene_id:e,trigger_key:"user.click"})});return{success:t.success,data:t.success}}async get_devices_prop(e){let t=await this.request("/miotspec/prop/get",{method:"POST",body:JSON.stringify({params:[{did:e.id,siid:2,piid:1}]})});return{success:t.success,data:t.data||[]}}async set_devices_prop(e){let t=Object.entries(e.properties).map(([,t])=>({did:e.id,siid:2,piid:1,value:t})),r=await this.request("/miotspec/prop/set",{method:"POST",body:JSON.stringify({params:t})});return{success:r.success,data:r.data||[]}}async run_action(e){let t=await this.request("/miotspec/action",{method:"POST",body:JSON.stringify({params:{did:e.device_id,siid:2,aiid:1,value:e.params}})});return{success:t.success,data:t.data||{}}}async get_device_by_name(e){let t=await this.get_devices_list();return t.success&&t.data?{success:!0,data:t.data.find(t=>t.name===e)||null}:{success:!1,error:"Failed to get devices"}}async get_device_by_id(e){let t=await this.get_devices_list();return t.success&&t.data?{success:!0,data:t.data.find(t=>t.id===e)||null}:{success:!1,error:"Failed to get devices"}}async update_device(e){let t=await this.get_device_by_id(e.device_id);if(!t.success||!t.data)return{success:!1,error:"Device not found"};let r=t.data;return r.properties={...r.properties,...e.properties},await this.set_devices_prop(r)}}},47552,(e,t,r)=>{},15220,e=>{"use strict";e.s(["handler",()=>A,"patchFetch",()=>k,"routeModule",()=>w,"serverHooks",()=>b,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>S],15220);var t=e.i(47909),r=e.i(74017),s=e.i(96250),a=e.i(59756),i=e.i(61916),n=e.i(69741),o=e.i(16795),c=e.i(87718),d=e.i(95169),u=e.i(47587),l=e.i(66012),p=e.i(70101),h=e.i(26937),_=e.i(10372),m=e.i(93695);e.i(52474);var g=e.i(220);e.s(["GET",()=>y],68399);var v=e.i(89171);e.i(42299);var f=e.i(74601);async function y(){try{let e=await f.mijiaAPI.get_homes_list();if(e.success&&e.data)return v.NextResponse.json({success:!0,data:e.data});return v.NextResponse.json({success:!1,error:e.error||"Failed to fetch homes from Mijia API"},{status:500})}catch(e){return console.error("Get homes error:",e),v.NextResponse.json({success:!1,error:"Failed to fetch homes"},{status:500})}}var x=e.i(68399);let w=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/homes/route",pathname:"/api/homes",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/homes/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:R,workUnitAsyncStorage:S,serverHooks:b}=w;function k(){return(0,s.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:S})}async function A(e,t,s){var v;let f="/api/homes/route";f=f.replace(/\/index$/,"")||"/";let y=await w.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:x,params:R,nextConfig:S,isDraftMode:b,prerenderManifest:k,routerServerContext:A,isOnDemandRevalidate:E,revalidateOnlyGenerated:T,resolvedPathname:C}=y,O=(0,n.normalizeAppPath)(f),N=!!(k.dynamicRoutes[O]||k.routes[C]);if(N&&!b){let e=!!k.routes[C],t=k.dynamicRoutes[O];if(t&&!1===t.fallback&&!e)throw new m.NoFallbackError}let P=null;!N||w.isDev||b||(P="/index"===(P=C)?"/":P);let q=!0===w.isDev||!N,j=N&&!q,U=e.method||"GET",$=(0,i.getTracer)(),H=$.getActiveScopeSpan(),M={params:R,prerenderManifest:k,renderOpts:{experimental:{cacheComponents:!!S.experimental.cacheComponents,authInterrupts:!!S.experimental.authInterrupts},supportsDynamicResponse:q,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(v=S.experimental)?void 0:v.cacheLife,isRevalidate:j,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>w.onRequestError(e,t,s,A)},sharedContext:{buildId:x}},D=new o.NodeNextRequest(e),I=new o.NodeNextResponse(t),F=c.NextRequestAdapter.fromNodeNextRequest(D,(0,c.signalFromNodeResponse)(t));try{let n=async r=>w.handle(F,M).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=$.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=s.get("next.route");if(a){let e=`${U} ${a}`;r.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),r.updateName(e)}else r.updateName(`${U} ${e.url}`)}),o=async i=>{var o,c;let d=async({previousCacheEntry:r})=>{try{if(!(0,a.getRequestMeta)(e,"minimalMode")&&E&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(i);e.fetchMetrics=M.renderOpts.fetchMetrics;let c=M.renderOpts.pendingWaitUntil;c&&s.waitUntil&&(s.waitUntil(c),c=void 0);let d=M.renderOpts.collectedTags;if(!N)return await (0,l.sendResponse)(D,I,o,M.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[_.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,s=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:j,isOnDemandRevalidate:E})},A),t}},m=await w.handleResponse({req:e,nextConfig:S,cacheKey:P,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:E,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:s.waitUntil});if(!N)return null;if((null==m||null==(o=m.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==m||null==(c=m.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,a.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",E?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,p.fromNodeOutgoingHttpHeaders)(m.value.headers);return(0,a.getRequestMeta)(e,"minimalMode")&&N||v.delete(_.NEXT_CACHE_TAGS_HEADER),!m.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,h.getCacheControlHeader)(m.cacheControl)),await (0,l.sendResponse)(D,I,new Response(m.value.body,{headers:v,status:m.value.status||200})),null};H?await o(H):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${U} ${e.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},o))}catch(t){if(H||t instanceof m.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:j,isOnDemandRevalidate:E})}),N)throw t;return await (0,l.sendResponse)(D,I,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8aa08f76._.js.map